:root{
  --bg: #0b1220;
  --card: rgba(255,255,255,.08);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.70);
  --border: rgba(255,255,255,.12);

  --chip: rgba(255,255,255,.10);
  --chip2: rgba(255,255,255,.14);
}

*{ box-sizing: border-box; }

html, body{
  width: 100%;
  max-width: 100%;
  overflow-x: hidden; /* evita desbordaments horitzontals */
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color: var(--text);
  background: radial-gradient(1200px 700px at 20% 10%, #1b2a4a, var(--bg));
}

img, svg, video, canvas{
  max-width: 100%;
  height: auto;
}

/* =========================
   ACCESSIBILITAT
   ========================= */
.sr-only{
  position:absolute!important;
  width:1px!important;
  height:1px!important;
  padding:0!important;
  margin:-1px!important;
  overflow:hidden!important;
  clip:rect(0,0,0,0)!important;
  white-space:nowrap!important;
  border:0!important;
}

/* =========================
   HERO
   ========================= */
.hero{
  position: relative;
  min-height: 45vh;
  padding: 28px 18px;
  display: flex;
  align-items: flex-end;
  background-image: url("assets/valls.jpg");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

.hero__overlay{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.45);
}

.hero__content{
  position: relative;
  z-index: 1;
  color: #fff;
}

.hero.hero--small{
  min-height: 28vh;
}

h1{ margin: 0 0 6px; font-size: 28px; }
p{ margin: 0; color: var(--muted); }

.status{
  margin-top: 6px;
  font-size: 12px;
  color: rgba(255,255,255,.75);
}

/* =========================
   LAYOUT
   ========================= */
.grid{
  display: grid;
  grid-template-columns: 1fr;
  gap: 14px;
  padding: 14px;
  max-width: 1100px;
  margin: 0 auto;
}

@media (min-width: 900px){
  .grid{ grid-template-columns: 1.2fr .8fr; }
}

.span2{ grid-column: 1 / -1; }

.card{
  position: relative; /* Ãºtil per icones/absoluts dins cards */
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 14px;
  backdrop-filter: blur(10px);
  max-width: 100%;
  min-width: 0;
}

h2{
  margin: 0 0 12px;
  font-size: 16px;
  color: var(--text);
}

.card-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

/* Footer */
.footer{
  padding: 18px;
  text-align: center;
  color: var(--muted);
  border-top: 1px solid var(--border);
}

.footer a{
  color: inherit;
  text-decoration: underline;
  text-underline-offset: 3px;
  opacity: .95;
}
.footer a:hover{ opacity: 1; }

/* BotÃ³ tornada */
.back-link{
  display: inline-block;
  padding: 10px 16px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: var(--chip2);
  color: var(--text);
  font-weight: 600;
  text-decoration: none;
  transition: background .2s ease, transform .1s ease;
}
.back-link:hover{ background: var(--chip); }
.back-link:active{ transform: translateY(1px); }

/* =========================
   KPI GENERIC (si el fas servir fora de Home)
   ========================= */
.kpis{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
@media (min-width: 520px){
  .kpis{ grid-template-columns: repeat(4, 1fr); }
}
.kpi{
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px;
  min-width: 0;
  background: rgba(255,255,255,.03);
}
.kpi__v{ font-size: 22px; font-weight: 700; }
.kpi__l{ font-size: 12px; color: var(--muted); margin-top: 4px; }

/* =========================
   HOME â€” CARD â€œACTUALâ€ (definitiu)
   ========================= */

/* Header â€œActualâ€: tÃ­tol + icona dreta */
#cardCurrent .card-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

#cardCurrent .now-icon{
  font-size: 34px;
  line-height: 1;
  opacity: .95;
  user-select: none;
  pointer-events: none;
  flex: 0 0 auto;
  transform: translateY(2px);
}

/* Pill Font */
#cardCurrent .now-source{
  margin: 6px 0 12px;
}
#cardCurrent .pill{
  display: inline-flex;
  align-items: center;
  font-size: 13px;
  line-height: 1;
  padding: 7px 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.82);
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* KPIs layout (2x2 + 2 grans) */
#cardCurrent .kpi-grid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

#cardCurrent .kpi{
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.04);
  border-radius: 18px;
  padding: 12px 14px;
  min-width: 0;
}

#cardCurrent .kpi-val{
  font-size: 26px;   /* definitiu (sense !important) */
  line-height: 1.05;
  letter-spacing: -0.02em;
  font-variant-numeric: tabular-nums;
}
#cardCurrent .kpi-lab{
  margin-top: 6px;
  font-size: 13px;
  opacity: .82;
}

/* 2 KPIs grans a la fila inferior */
#cardCurrent .kpi--wide-left{ grid-column: 1; }
#cardCurrent .kpi--wide-right{ grid-column: 2; }

@media (max-width: 380px){
  #cardCurrent .kpi--wide-left,
  #cardCurrent .kpi--wide-right{ grid-column: 1 / -1; }
}

/* Chips: 1 per fila */
#cardCurrent .chips-grid{
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-top: 14px;
}
#cardCurrent .chip{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  padding: 12px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  min-width: 0;
}
#cardCurrent .chip > span{
  font-size: 13.5px;
  opacity: .82;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#cardCurrent .chip > strong{
  font-size: 14px;
  font-weight: 700;
  text-align: right;
  font-variant-numeric: tabular-nums;
  white-space: normal;
  line-height: 1.15;
  max-width: 65%;
}

/* =========================
   SELECT MUNICIPI
   ========================= */
.muni-picker{
  margin-top: 10px;
  display: flex;
  justify-content: flex-start;
  align-items: center;
}

.muni-picker select{
  appearance: none;
  -webkit-appearance: none;
  padding: 7px 34px 7px 12px;
  font-size: 14px;
  line-height: 1.2;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.30);

  background:
    rgba(0,0,0,.35)
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14'><polygon points='2,4 12,4 7,10' fill='white'/></svg>")
    no-repeat right 12px center;

  color: #fff;
  width: 220px;
  max-width: 70vw;
  box-sizing: border-box;

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;

  backdrop-filter: blur(6px);
  box-shadow: 0 6px 18px rgba(0,0,0,.28);
}

.muni-picker select:focus{
  outline: none;
  border-color: rgba(255,255,255,.55);
  box-shadow: 0 0 0 3px rgba(255,255,255,.12), 0 8px 22px rgba(0,0,0,.32);
}

.muni-picker--double{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
}
.muni-picker--double select{ min-width: 220px; }

/* =========================
   CHARTS (Chart.js)
   ========================= */
.chart-box{
  height: 260px;
  display: flex;
  flex-direction: column;
  min-width: 0;
}
.card.chart-box h2{
  margin: 0 0 10px;
  line-height: 1.2;
}
.chart-box canvas{
  width: 100% !important;
  flex: 1 1 auto !important;
  height: auto !important;
  display: block;
}
@media (min-width: 900px){
  .card.chart-box.span2{ height: 300px; }
}

/* TÃ­tol de les grÃ fiques amb botÃ³ â›¶ */
.chart-box h2{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.fs-zoom-btn{
  appearance:none;
  border:0;
  background: rgba(255,255,255,0.10);
  color: inherit;
  padding: 6px 10px;
  border-radius: 12px;
  font-size: 16px;
  line-height: 1;
}
.fs-zoom-btn:active{ transform: scale(.98); }

/* Fullscreen charts modal */
.fs-overlay{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 12px;
  background: rgba(0,0,0,0.75);
  z-index: 9999;
}
.fs-overlay.open{ display:flex; }

.fs-panel{
  width: min(980px, 100%);
  height: min(760px, 100%);
  border-radius: 18px;
  background: #0b1220;
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 12px 40px rgba(0,0,0,0.45);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.fs-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.10);
}
.fs-title{ font-weight:700; font-size:15px; opacity:.95; }

.fs-close{
  appearance:none;
  border:0;
  background: rgba(255,255,255,0.10);
  color: inherit;
  padding: 8px 10px;
  border-radius: 12px;
  font-size: 16px;
}

.fs-body{ flex:1; padding:12px; display:flex; }
.fs-canvas-host{ position:relative; width:100%; height:100%; }
.fs-canvas-host canvas{ width:100% !important; height:100% !important; }

html.fs-lock, body.fs-lock{ overflow:hidden; }
.fs-lock .fs-zoom-btn{ display:none !important; }

/* =========================
   FORECAST HOURLY RAIL
   ========================= */
.fx-shelf{ width:100%; overflow:hidden; }

.fx-rail{
  display:flex;
  flex-wrap:nowrap;
  gap:12px;
  overflow-x:auto;
  overflow-y:hidden;
  padding: 10px 4px 14px;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  overscroll-behavior-x: contain;
  scrollbar-width: none;
  min-width:0;

  mask-image: linear-gradient(to right,
    transparent 0,
    black 18px,
    black calc(100% - 18px),
    transparent 100%);
}
.fx-rail::-webkit-scrollbar{ display:none; }

.fx-item{
  flex: 0 0 auto;
  width: 140px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.035);
  border-radius: 18px;
  padding: 12px 12px 10px;
  scroll-snap-align: start;
  backdrop-filter: blur(8px);
}

.fx-time{ font-size:14px; font-weight:750; letter-spacing:.2px; opacity:.92; }
.fx-icon{ font-size:34px; line-height:1; margin:10px 0 8px; }
.fx-temp{ font-size:30px; font-weight:900; line-height:1; margin-bottom:10px; }

.fx-row{
  display:flex;
  align-items: baseline;
  gap: 8px;
  padding: 6px 0;
  border-top: 1px solid rgba(255,255,255,.08);
}
.fx-row:first-of-type{ border-top:0; }
.fx-k{ width:18px; opacity:.9; }
.fx-v{ font-size:13px; color: rgba(255,255,255,.88); white-space: nowrap; }
.fx-row--wind .fx-v{ overflow:hidden; text-overflow: ellipsis; }

.fx-track{
  height: 2px;
  width: 100%;
  background: rgba(255,255,255,.08);
  border-radius: 999px;
  margin: 6px 0 10px;
}

/* Forecast 7 dies */
.fx7{ display:grid; gap:10px; }

.fx7-row{
  display:grid;
  grid-template-columns: 1.2fr 1fr .9fr;
  gap:12px;
  align-items:center;
  padding:12px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.03);
  border-radius:16px;
  min-width:0;
}

.fx7-left, .fx7-mid, .fx7-right{ min-width:0; }

.fx7-date{ font-weight:800; letter-spacing:.2px; }

.fx7-sky{
  margin-top:4px;
  font-size:12.5px;
  color: rgba(255,255,255,.75);
  line-height:1.2;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.fx7-mid{ display:grid; gap:8px; justify-items: stretch; }

.fx7-bar{
  position:relative;
  height:6px;
  width:100%;
  border-radius:999px;
  background: rgba(255,255,255,.10);
  overflow:hidden;
}
.fx7-bar span{
  position:absolute; top:0; bottom:0;
  border-radius:999px;
  background: linear-gradient(90deg,#4fc3f7 0%,#81c784 35%,#ffd54f 65%,#ff7043 100%);
  box-shadow: 0 0 6px rgba(255,255,255,.25);
  animation: fxGrow .5s ease-out both;
}
@keyframes fxGrow{
  from{ transform: scaleX(0); transform-origin:left; }
  to{ transform: scaleX(1); }
}

.fx7-temps{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  font-weight:900;
}
.fx7-min{ color: rgba(255,255,255,.78); }
.fx7-max{ color: rgba(255,255,255,.95); }

.fx7-pop{
  margin-top:4px;
  text-align:right;
  font-size:12.5px;
  color: rgba(255,255,255,.85);
}

@media (max-width: 520px){
  .fx7-row{
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "left right"
      "mid  mid";
  }
  .fx7-left{ grid-area:left; }
  .fx7-right{ grid-area:right; }
  .fx7-mid{ grid-area:mid; }

  .fx7-sky{
    white-space: normal;
    display:-webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow:hidden;
  }
}

.fx7-icon{ font-size:22px; line-height:1; opacity:.95; justify-self:start; }

.fx-wind-main{ font-size: .85rem; }
.fx-gust{ font-size: .7rem; opacity:.7; margin-top:2px; }

/* =========================
   ICONES SVG WX
   ========================= */
.wx{
  width: 34px;
  height: 34px;
  display: inline-block;
  color: rgba(255,255,255,.92);
  vertical-align: middle;
}
.wx use{ pointer-events:none; }

.wx--sun, .wx--partly { color: rgba(255, 214, 79, .95); }
.wx--rain, .wx--drizzle { color: rgba(79, 195, 247, .95); }
.wx--storm { color: rgba(186, 104, 200, .95); }
.wx--fog, .wx--cloud, .wx--cloud-moon { color: rgba(176, 190, 197, .95); }
.wx--snow { color: rgba(224, 247, 250, .95); }
.wx--wind { color: rgba(200, 230, 201, .95); }

/* =========================
   INSTALL FAB + TIP
   ========================= */
.install-fab{
  position: fixed;
  right: 16px;
  bottom: 18px;
  z-index: 9999;

  padding: 12px 14px;
  border-radius: 999px;

  border: 1px solid rgba(255,255,255,.14);
  background: rgba(25, 33, 52, .86);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  color: #fff;
  font-weight: 700;
  font-size: 14px;
  line-height: 1;

  box-shadow: 0 14px 34px rgba(0,0,0,.35);
  cursor: pointer;

  transition: transform .12s ease, opacity .12s ease;
  -webkit-tap-highlight-color: transparent;

  display:inline-flex;
  gap:8px;
  align-items:center;
}
.install-fab::before{ content:"â¬‡ï¸"; }

.install-fab:active{
  transform: scale(.98);
  opacity: .92;
}

@media (prefers-reduced-motion: reduce){
  .install-fab{ transition:none; }
}

.install-tip{
  position: fixed;
  inset: 0;
  z-index: 10000;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding:14px;
  background: rgba(0,0,0,.35);
}

.install-tip__card{
  width: min(520px, 100%);
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(25, 33, 52, .92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  color:#fff;
  box-shadow: 0 18px 46px rgba(0,0,0,.45);
  padding: 14px 14px 12px 14px;
}

.install-tip__title{ font-weight:800; font-size:16px; margin-bottom:6px; }
.install-tip__text{ opacity:.92; line-height:1.35; font-size:14px; margin-bottom:10px; }

.install-tip__close{
  width:100%;
  border-radius:12px;
  padding:10px 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color:#fff;
  font-weight:800;
  cursor:pointer;
}

/* iOS install banner */
.ios-banner{
  position: fixed;
  left: 12px;
  right: 12px;
  top: 12px;
  z-index: 10000;
  border-radius: 16px;
  background: rgba(11, 18, 32, 0.95);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 12px 40px rgba(0,0,0,0.35);
  padding: 10px 12px;
  display:flex;
  gap:10px;
  align-items:flex-start;
}

.ios-banner__txt{
  font-size: 13px;
  line-height: 1.25;
  opacity: .95;
}

.ios-banner__actions{
  display:flex;
  gap:8px;
  align-items:center;
  margin-left:auto;
}

.ios-banner__btn{
  appearance:none;
  border:0;
  padding:8px 10px;
  border-radius:12px;
  background: rgba(255,255,255,0.10);
  color: inherit;
  font-size: 13px;
  white-space: nowrap;
}

.ios-banner__close{
  appearance:none;
  border:0;
  background: transparent;
  color: inherit;
  font-size: 18px;
  line-height: 1;
  padding: 6px 6px;
  opacity: .85;
}

/* =========================
   PUSH
   ========================= */
.push-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color: inherit;
  font-weight:700;
  cursor:pointer;
}
.push-btn:disabled{ opacity:.55; cursor:not-allowed; }

.push-row{ margin-bottom:14px; }

.push-status-slot{
  margin-top:14px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,.08);
  text-align:center;
}

.push-btn-off{
  margin-top:8px;
  background:none;
  border:1px solid rgba(255,255,255,.25);
  color:#fff;
  padding:6px 14px;
  border-radius:14px;
}

.push-status{
  display:block;
  margin-top:8px;
  font-size:.92rem;
  opacity:.85;
}

/* =========================
   ALERT XL (banner dins pÃ gina principal)
   ========================= */
.alert-xl{
  position: relative;
  display:flex;
  align-items: stretch;
  gap:12px;
  padding: 14px;
  border-radius: 14px;

  background: rgba(20, 28, 45, 0.92);
  border: 1px solid rgba(255,255,255,0.08);
  border-left: 12px solid rgba(255,255,255,0.12);

  backdrop-filter: blur(6px);
}

.alert-xl__left{ flex:1; min-width:0; }

.alert-xl__title{
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 0.2px;
  line-height: 1.2;
  margin: 0 0 6px 0;
}
.alert-xl__msg{
  font-size: 14px;
  line-height: 1.35;
  opacity: 0.95;
  margin: 0 0 8px 0;
  word-break: break-word;
}
.alert-xl__meta{ font-size:12px; opacity:.75; }

.alert-xl__close{
  width:36px;
  height:36px;
  align-self:flex-start;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.85);
  cursor:pointer;
}
.alert-xl__close:hover{
  background: rgba(255,255,255,0.10);
  color:#fff;
}

/* Pestanya superior */
.alert-xl::before{
  content:"AVÃS";
  position:absolute;
  top:-10px;
  left:14px;
  font-size:11px;
  font-weight:900;
  letter-spacing:0.9px;
  text-transform:uppercase;
  padding: 4px 10px;
  border-radius:999px;
  background: rgba(255,176,32,0.95);
  color: rgba(0,0,0,0.9);
  border:1px solid rgba(0,0,0,0.12);
}

/* severitat */
.alert-xl.is-warn{
  border-left-color: rgba(255,176,32,0.95);
  box-shadow: 0 8px 22px rgba(0,0,0,0.25);
}

.alert-xl.is-danger{
  border-left-color: rgba(255,59,48,0.98);
  box-shadow:
    0 0 0 2px rgba(255,59,48,0.25),
    0 10px 30px rgba(0,0,0,0.30);
}

.alert-xl.is-danger::before{
  content:"ALERTA";
  background: rgba(255,59,48,0.98);
  color:#fff;
}

@keyframes alertPulse{
  0%   { box-shadow: 0 0 0 2px rgba(255,59,48,0.18), 0 10px 30px rgba(0,0,0,0.30); }
  50%  { box-shadow: 0 0 0 3px rgba(255,59,48,0.30), 0 12px 34px rgba(0,0,0,0.34); }
  100% { box-shadow: 0 0 0 2px rgba(255,59,48,0.18), 0 10px 30px rgba(0,0,0,0.30); }
}
.alert-xl.is-danger{ animation: alertPulse 1.6s ease-in-out infinite; }

@media (prefers-reduced-motion: reduce){
  .alert-xl.is-danger{ animation:none; }
}

/* icona segons categoria */
.alert-xl__title::before{ content:"âš ï¸ "; }
.alert-xl.cat-wind .alert-xl__title::before{ content:"ðŸ’¨ "; }
.alert-xl.cat-rain .alert-xl__title::before{ content:"ðŸŒ§ï¸ "; }
.alert-xl.cat-temp .alert-xl__title::before{ content:"ðŸŒ¡ï¸ "; }

/* separaciÃ³ entre meta i XL a avisos.html */
#mvAlertsMeta{ margin-bottom: 8px; }
#mvAlertsSummary{ margin-top: 12px; }

/* espai XL -> push */
.alert-xl + .push-row{ margin-top:14px; }
@media (max-width: 720px){
  .alert-xl + .push-row{ margin-top:16px; }
}

/* =========================
   METEOCAT FAB (Ãºnic, depurat)
   ========================= */
.mv-hidden{ display:none !important; }

#meteocatIcon{ visibility: hidden; }

.mv-icon{
  position: fixed;
  right: 16px;
  bottom: 90px;
  z-index: 9999;

  width: 56px;
  height: 56px;
  border-radius: 50%;

  display:flex;
  align-items:center;
  justify-content:center;

  font-size: 26px;
  text-decoration:none;
  color:#fff;

  background: rgba(20,28,45,.92);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(10px);

  box-shadow: 0 10px 24px rgba(0,0,0,.35);
  transition: transform .15s ease;
}
.mv-icon:hover{ transform: scale(1.05); }

.mv-icon__count{
  position:absolute;
  top:-4px;
  right:-4px;
  min-width:20px;
  height:20px;
  padding:0 6px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  display:fl
